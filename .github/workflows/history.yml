name: Show Action History

on:
  workflow_dispatch:  # esecuzione manuale

jobs:
  show-history:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show recent workflow runs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Recent workflow runs for this repository:"
          gh run list --limit 10
          
      - name: Show last run details for each workflow
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ðŸ“œ Getting latest runs grouped by workflow..."
          gh run list --limit 20 --json id,workflowName,conclusion,headBranch,createdAt \
          | jq -c '.[]' \
          | while read -r run; do
              id=$(echo "$run" | jq -r '.id')
              name=$(echo "$run" | jq -r '.workflowName')
          
              echo "ðŸ”§ $name â†’ Run ID $id"
              gh run view "$id" --log --exit-status
          done
