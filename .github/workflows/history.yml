name: Show Action History

on:
  workflow_dispatch:  # esecuzione manuale

jobs:
  show-history:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show recent workflow runs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Recent workflow runs for this repository:"
          gh run list --limit 10
          
      - name: Show last run details for each workflow
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üìú Getting list of workflows..."
          workflows=$(gh run list --limit 10 --json name,databaseId )

          for name,id in $workflows; do
            name=$(echo "$name" | jq -r '.name')
            id=$(echo "$id" | jq -r '.databaseId')
            echo "----------------------------------------"
            echo "üîç Workflow: $name (ID: $id)
            echo "----------------------------------------
            echo "Fetching latest run details for workflow: $name"
            echo "----------------------------------------"
            output=$(gh run view "$id" --verbose)
            echo "$output"  
          done
